# 掼蛋游戏项目 - 运行指南

## 📋 前置要求

### 1. 安装 Java 17 或更高版本
- 下载地址：https://www.oracle.com/java/technologies/downloads/#java17
- 或者使用 OpenJDK：https://adoptium.net/
- 验证安装：在命令行运行 `java -version`，应该显示 Java 17 或更高版本

### 2. 安装 Maven
- 下载地址：https://maven.apache.org/download.cgi
- 解压后配置环境变量 `MAVEN_HOME` 和 `PATH`
- 验证安装：在命令行运行 `mvn -version`

### 3. 安装 Node.js 和 npm
- 下载地址：https://nodejs.org/
- 验证安装：在命令行运行 `node -v` 和 `npm -v`

## 🚀 运行步骤

### 后端启动

#### 方法一：使用 Maven 直接运行（推荐）

1. **打开命令行/终端**
   - Windows: 按 `Win + R`，输入 `cmd` 或 `powershell`
   - 导航到后端目录：
     ```bash
     cd d:\java\javacode\vue\Login+Battle\backend
     ```

2. **编译并运行项目**
   ```bash
   mvn spring-boot:run
   ```
   
   或者先编译再运行：
   ```bash
   mvn clean package
   java -jar target/guandan-backend-1.0.0.jar
   ```

3. **等待启动完成**
   - 看到以下信息表示启动成功：
     ```
     ========================================
       掼蛋游戏后端服务启动成功！
       接口文档: http://localhost:8081/api/doc.html
       健康检查: http://localhost:8081/api/actuator/health
     ========================================
     ```

#### 方法二：使用 IDE（IntelliJ IDEA / Eclipse）

1. **导入项目**
   - IntelliJ IDEA: `File` -> `Open` -> 选择 `backend` 目录
   - Eclipse: `File` -> `Import` -> `Existing Maven Projects`

2. **等待 Maven 依赖下载完成**
   - IDE 会自动下载所有依赖（首次运行可能需要几分钟）

3. **运行主类**
   - 找到 `GuadanApplication.java`
   - 右键点击 -> `Run 'GuadanApplication'`

### 前端启动

1. **打开命令行/终端**
   - 导航到前端目录：
     ```bash
     cd d:\java\javacode\vue\Login+Battle\frontend
     ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动开发服务器**
   ```bash
   npm run dev
   ```

4. **等待启动完成**
   - 看到以下信息表示启动成功：
     ```
     VITE v5.x.x  ready in xxx ms

     ➜  Local:   http://localhost:5173/
     ➜  Network: use --host to expose
     ```

5. **打开浏览器**
   - 访问 http://localhost:5173/
   - 开始游戏！

## 🧪 测试功能

### 1. 用户注册和登录

1. 打开浏览器访问 http://localhost:5173/
2. 点击"注册"按钮，填写用户名和密码
3. 注册成功后会自动登录
4. 进入游戏大厅

### 2. 创建房间

1. 在游戏大厅点击"创建房间"
2. 等待其他玩家加入
3. 当4个玩家都准备好后，游戏自动开始

### 3. 出牌提示功能

1. 在游戏中点击"提示"按钮
2. 系统会根据当前游戏状态建议出牌
3. 建议的卡牌会以金色脉冲动画高亮显示
4. 卡牌会自动选中，可以直接点击"出牌"

### 4. WebSocket 连接测试

打开浏览器开发者工具（F12），在控制台中输入：

```javascript
// 连接到WebSocket
const ws = new WebSocket('ws://localhost:8081/ws/game/Player1');

// 监听消息
ws.onopen = () => console.log('连接成功');
ws.onmessage = (event) => console.log('收到消息:', event.data);
ws.onerror = (error) => console.error('错误:', error);
ws.onclose = () => console.log('连接关闭');

// 发送出牌消息
ws.send(JSON.stringify({
    type: 'PLAY_CARD',
    data: { cards: [0, 1, 2] }
}));
```

## 📝 项目结构说明

```
Login+Battle/
├── backend/              # 后端项目（Spring Boot）
│   ├── src/
│   │   └── main/
│   │       ├── java/     # Java源代码
│   │       └── resources/ # 配置文件
│   ├── pom.xml          # Maven配置
│   └── README.md       # 后端说明文档
├── frontend/            # 前端项目（Vue 3）
│   ├── src/
│   │   ├── api/       # API接口
│   │   ├── assets/    # 静态资源
│   │   ├── components/# 组件
│   │   ├── router/    # 路由配置
│   │   ├── utils/     # 工具函数
│   │   └── views/     # 页面组件
│   ├── dist/          # 构建输出
│   ├── package.json    # NPM配置
│   └── vite.config.js # Vite配置
└── 运行指南.md        # 本文件
```

## 🔍 查看日志

### 后端日志
服务器运行时的日志会显示在控制台中，包括：
- WebSocket连接建立/关闭
- 玩家加入房间
- 游戏开始
- 玩家出牌
- 出牌提示
- 错误信息

### 前端日志
打开浏览器开发者工具（F12），在控制台中可以看到：
- WebSocket连接状态
- 发送和接收的消息
- 游戏状态更新
- 错误信息

## ⚠️ 常见问题

### 1. 端口8081被占用
**解决方案**：
- 修改 `backend/src/main/resources/application.yml` 中的端口号
- 或者关闭占用8081端口的程序

### 2. 端口5173被占用
**解决方案**：
- 修改 `frontend/vite.config.js` 中的端口号
- 或者关闭占用5173端口的程序

### 3. Maven依赖下载失败
**解决方案**：
- 检查网络连接
- 配置Maven镜像（在 `~/.m2/settings.xml` 中）：
  ```xml
  <mirrors>
    <mirror>
      <id>aliyun</id>
      <mirrorOf>central</mirrorOf>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
  ```

### 4. npm install 失败
**解决方案**：
- 检查网络连接
- 使用国内镜像：
  ```bash
  npm config set registry https://registry.npmmirror.com
  npm install
  ```

### 5. Lombok 编译错误
**解决方案**：
- 确保IDE安装了Lombok插件
- IntelliJ IDEA: `File` -> `Settings` -> `Plugins` -> 搜索 "Lombok" 并安装

### 6. WebSocket连接失败
**解决方案**：
- 确保后端服务器已启动
- 检查防火墙设置
- 确认URL格式正确：`ws://localhost:8081/ws/game/{playerId}`

## 🎮 游戏功能说明

### 已实现功能
- ✅ 用户注册和登录
- ✅ 房间创建和加入
- ✅ 游戏开始和发牌
- ✅ 出牌功能
- ✅ 出牌提示功能
- ✅ AI玩家自动出牌
- ✅ 游戏状态同步
- ✅ WebSocket实时通信

### 牌型识别
- ✅ 单张
- ✅ 对子
- ✅ 三张
- ✅ 顺子
- ✅ 三带二
- ✅ 钢板
- ✅ 同花顺
- ✅ 炸弹

### 比牌规则
- ✅ 同类型牌型比大小
- ✅ 炸弹压制非炸弹牌型
- ✅ 更大炸弹压制小炸弹

## 📚 下一步

- 完善掼蛋游戏规则（连对、天王炸等）
- 添加游戏记录和统计功能
- 实现好友系统
- 添加聊天功能
- 优化UI和用户体验

## 🎯 快速测试命令

```bash
# 后端
cd backend
mvn clean package
mvn spring-boot:run

# 前端（新开一个终端）
cd frontend
npm install
npm run dev
```